!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t||self).Etto=e()}(this,function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function e(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var o=function(){function t(t){this.el=t,this.listeners={}}var e=t.prototype;return e.addEventListener=function(t,e){t in this.listeners?console.warn("Cannot add multiple event listeners to Etto Element"):(this.listeners[t]=e,this.el.addEventListener(t,e))},e.removeEventListener=function(t){t in this.listeners&&(this.el.removeEventListener(t,this.listeners[t],!1),delete this.listeners[t])},e.removeAllEvents=function(){for(var t in this.listeners)this.removeEventListener(t)},e.applyClassList=function(t){var e;(e=this.el.classList).add.apply(e,t)},e.applyAttributes=function(t){for(var e in t)this.el.setAttribute(e,t[e])},e.appendChild=function(t){this.el.appendChild(t)},e.setDisplay=function(t){this.el.style.display=t},t}(),l=function(t){function n(e,s,n,o,l,h,r,a,c,u){var d;return void 0===a&&(a=[]),void 0===u&&(u={}),(d=t.call(this,e)||this).applyClassList(["etto-input"].concat(a)),d.applyAttributes(i({type:"text",autocomplete:"off",value:"",style:"box-sizing: border-box; cursor: "+(r?"default":"text")+";",tabIndex:r?"-1":"0",placeholder:c},u)),d.onValue=h,d.addEventListener("input",s),d.addEventListener("focus",n),d.addEventListener("blur",o),d.addEventListener("keydown",l),d}s(n,t);var o=n.prototype;return o.setValue=function(t){this.el.value=t,this.onValue&&this.onValue(t)},o.setPlaceholder=function(t){this.el.placeholder=t},o.focus=function(){this.el.focus()},o.blur=function(){this.el.blur()},o.setCursorToEnd=function(){this.el.selectionStart=this.el.selectionEnd=this.el.value.length},e(n,[{key:"offsetHeight",get:function(){return this.el.offsetHeight}},{key:"value",get:function(){return this.el.value}}]),n}(o),h=function(t){function e(e,i){var s;return(s=t.call(this,e)||this).applyClassList(["etto-dropdown"]),s.applyAttributes({style:(i?"max-height: 300px; ":"")+(i?"overflow: hidden auto; ":"overflow: hidden; ")+"position: absolute; width: 100%; z-index: 99;"}),s.hide(),s}s(e,t);var i=e.prototype;return i.isVisible=function(){return"block"===this.el.style.display},i.hide=function(){this.setDisplay("none")},i.show=function(){this.setDisplay("block")},e}(o),r=function(t){function e(e,i){var s;return(s=t.call(this,e)||this).dotSize=i||6,s.dots=[],s.currentDot=0,s.loOpacity="0.3",s.hiOpacity="0.7",s.applyClassList(["etto-spinner"]),s.applyAttributes({style:"position: absolute; display: none; align-items: center; right: 2rem;"}),s.createDots(),s.animateDots(),s}s(e,t);var i=e.prototype;return i.hide=function(){this.setDisplay("none")},i.show=function(){this.setDisplay("flex")},i.createDots=function(){for(var t=0;t<3;t++){var e=document.createElement("div");e.classList.add("etto-spinner-dot"),e.setAttribute("style","border-radius: 2em; margin: 0 0.1em; display: inline-block; transition: all 0.3s ease;"),e.style.height=this.dotSize+"px",e.style.width=this.dotSize+"px",this.dots.push(e),this.el.appendChild(e)}},i.animateDots=function(){for(var t=0;t<this.dots.length;t++)this.dots[t].style.opacity=this.loOpacity;this.currentDot==this.dots.length&&(this.currentDot=0),this.dots[this.currentDot].style.opacity=this.hiOpacity,this.currentDot+=1},e}(o),a=function(t){function e(e,i){var s;return(s=t.call(this,e)||this).applyClassList(["etto-clear-btn"]),s.applyAttributes({style:"opacity: 0.7; position: absolute; display: none; right: 0.8rem; cursor: pointer; font-family: sans-serif; font-size: 20px; font-weight: 400; "}),s.addEventListener("click",i),s.el.innerHTML="&times;",s}s(e,t);var i=e.prototype;return i.show=function(){this.el.style.display="flex"},i.hide=function(){this.el.style.display="none"},e}(o);function c(t,e,i,s){var n=t.toUpperCase(),o=e.filter(function(t){var e=t.label,s=e.toUpperCase().indexOf(n);return s>-1&&(!i||void 0===e[s-1]||" "===e[s-1])});return void 0!==s&&(o=o.slice(0,s)),o}function u(t){return Object.assign({},t,{label:t.label,value:null!=t.value?t.value:t.label})}var d=function(t){function e(e,i,s,n){var o;return(o=t.call(this,e)||this).itemMouseDownEvt=i,o.createItemFn=s||o.createListItem,o.emptyHtml=n||"<em>No results.</em>",o.applyClassList(["etto-ul"]),o}s(e,t);var i=e.prototype;return i.setInnerHtml=function(t){this.el.innerHTML=t},i.createListItem=function(t,e,i,s,n){var o="etto-li";return s&&(o+=" etto-highlighted"),n&&(o+=" etto-selected"),'<li class="'+o+'" style="list-style-type: none; cursor: default" data-label="'+t.label+'" data-value="'+t.value+'" data-index="'+e+'">'+function(t,e){var i=t.replace(/&/g,"").replace(/</g,"").replace(/>/g,""),s=e.length,n=t.toUpperCase().indexOf(e.toUpperCase());return n<0?i:i.slice(0,n)+"<b>"+i.slice(n,n+s)+"</b>"+i.slice(n+s)}(t.label,i)+"</li>"},i.populateList=function(t,e,i,s){var n=this;this.setInnerHtml("");var o="",l=e.length;if(l>0){for(var h=0;h<l;h++)o+=this.createItemFn(e[h],h,t,h===i,!!s&&e[h].value===s.value);this.setInnerHtml(o),this.removeEventListener("mousedown"),this.addEventListener("mousedown",function(t){t.target&&"LI"==t.target.nodeName&&n.itemMouseDownEvt(e[t.target.dataset.index])})}else this.setInnerHtml(o+='<li class="etto-li etto-empty">'+this.emptyHtml+"</li>")},e}(o),p=function(){function t(t){this.state=t}var e=t.prototype;return e.setHighlighted=function(t){this.state.highlighted=t},e.setSelected=function(t){this.state.selected=t},e.setCache=function(t){this.state.cache=t},e.setChoices=function(t){this.state.choices=t},e.setFiltered=function(t){this.state.filtered=t},e.setIsFetching=function(t){this.state.isFetching=t},e.setSpinnerTimer=function(t){this.state.spinnerTimer=t},e.clearSpinnerTimer=function(){clearInterval(this.state.spinnerTimer)},e.setFetchTimer=function(t){this.state.fetchTimer=t},e.clearFetchTimer=function(){clearTimeout(this.state.fetchTimer)},t}(),f=function(){function t(t,e,i){void 0===e&&(e={}),this.selectMode=e.selectMode||!1,this.source=e.source||void 0,this.minChars=e.minChars||3,this.maxResults=e.maxResults||7,this.requestDelay=e.requestDelay||350,this.matchFullWord=e.matchFullWord||!1,this.showEmptyMsg=void 0===e.showEmptyMsg||e.showEmptyMsg,this.initialCache=e.initialCache||{},this.defaultPlaceholder=e.placeholder||(e.selectMode?"Select...":""),this.emptyHtml=e.emptyHtml||void 0,this.createItemFn=e.createItemFn||void 0,this.filterFn=e.filterFn||c,this.onSelect=e.onSelect||void 0,this.onClear=e.onClear||void 0,this.onValue=e.onValue||void 0;var s=i?i.map(u):[];this.state={isFetching:!1,cache:this.initialCache,choices:s,filtered:[],selected:null,highlighted:null,spinnerTimer:null,fetchTimer:null},this.actions=new p(this.state),this.Input=new l(document.createElement("input"),this.onInput.bind(this),this.onFocus.bind(this),this.onBlur.bind(this),this.onKeydown.bind(this),this.onValue,this.selectMode,e.classList,this.defaultPlaceholder,e.inputAttributes),this.Spinner=new r(document.createElement("div"),6),this.ClearBtn=new a(document.createElement("div"),this.clear.bind(this)),this.UnorderedList=new d(document.createElement("ul"),this.itemMouseDownEvt.bind(this),this.createItemFn,this.emptyHtml),this.Dropdown=new h(document.createElement("div"),this.selectMode),this.Dropdown.appendChild(this.UnorderedList.el),this.container=document.createElement("div"),this.container.classList.add("etto-container"),this.container.setAttribute("style","position: relative;");var n=document.createElement("div");n.classList.add("etto-input-container"),n.setAttribute("style","position: relative;"),n.appendChild(this.Input.el),n.appendChild(this.ClearBtn.el),n.appendChild(this.Spinner.el),this.container.appendChild(n),this.container.appendChild(this.Dropdown.el),this.root=t,this.root.appendChild(this.container)}var e=t.prototype;return e.render=function(t,e){this.UnorderedList.populateList(t,e,this.state.highlighted,this.state.selected)},e.setShowDropdown=function(t){t?this.Dropdown.show():this.Dropdown.hide(),!t&&this.state.highlighted&&this.actions.setHighlighted(null)},e.fetchFromSource=function(t){var e=this,s=t.toUpperCase().trim();this.state.cache[s]?this.onReceiveChoices(this.state.cache[s]):(this.state.fetchTimer&&this.actions.clearFetchTimer(),this.actions.setFetchTimer(setTimeout(function(){e.actions.setIsFetching(!0),e.actions.setSpinnerTimer(setInterval(e.Spinner.animateDots.bind(e.Spinner),300)),e.Spinner.show(),e.source(t,function(t){var n,o=t?t.map(u):[];e.actions.setCache(i({},e.state.cache,((n={})[s]=o,n))),e.actions.setIsFetching(!1),e.Spinner.hide(),e.actions.clearSpinnerTimer(),e.onReceiveChoices(o)})},this.requestDelay)))},e.onReceiveChoices=function(t){var e=this.filterFn(this.Input.value,t,this.matchFullWord,this.maxResults);this.actions.setChoices(t),this.actions.setFiltered(e),this.render(this.Input.value,e),this.setShowDropdown(!!this.showEmptyMsg||e.length>0)},e.onKeydown=function(t){var e=this.Dropdown.isVisible();if((38==t.keyCode||40==t.keyCode)&&e){t.preventDefault(),38==t.keyCode&&(null===this.state.highlighted?this.actions.setHighlighted(0):0!==this.state.highlighted&&this.actions.setHighlighted(this.state.highlighted-1)),40==t.keyCode&&(null===this.state.highlighted?this.actions.setHighlighted(0):this.state.highlighted!==this.state.filtered.length-1&&this.actions.setHighlighted(this.state.highlighted+1)),this.render(this.Input.value,this.state.filtered),this.setShowDropdown(this.state.filtered.length>0);var i=this.UnorderedList.el.getElementsByClassName("etto-highlighted")[0];if(null!=i)try{i.scrollIntoView({block:"nearest",inline:"nearest"})}catch(t){}}9!=t.keyCode&&13!=t.keyCode||e&&(t.preventDefault(),null!==this.state.highlighted&&this.onSelection(this.state.filtered[this.state.highlighted]))},t}(),v=function(t){function e(e,i,s){var n;return(n=t.call(this,e,i,s)||this).render(n.Input.value,n.state.filtered),n}s(e,t);var i=e.prototype;return i.clear=function(){this.actions.setSelected(null),this.actions.setFiltered([]),this.Input.setValue(""),this.ClearBtn.hide(),this.render(this.Input.value,this.state.filtered),this.onClear&&this.onClear()},i.onInput=function(t){var e=t.target.value;this.onValue&&this.onValue(e),e?this.ClearBtn.show():this.ClearBtn.hide(),e&&e.trim().length>=this.minChars?this.source?this.fetchFromSource(e):this.onReceiveChoices(this.state.choices):(this.actions.setFiltered([]),this.render(e,[]),this.setShowDropdown(!1))},i.onFocus=function(){this.setShowDropdown(this.state.filtered.length>0),this.Input.setCursorToEnd()},i.onBlur=function(){null!==this.state.highlighted&&(this.actions.setHighlighted(null),this.render(this.Input.value,this.state.filtered)),this.setShowDropdown(!1)},i.onSelection=function(t){var e=this.filterFn(t.label,this.state.choices,this.matchFullWord,this.maxResults);this.Input.setValue(t.value),this.actions.setFiltered(e),this.actions.setHighlighted(null),this.render(t.label,e),this.setShowDropdown(!1),this.onSelect&&this.onSelect(t)},i.itemMouseDownEvt=function(t){this.onSelection(t),this.Input.focus()},e}(f),m=function(t){function e(e,i,s){var n;return(n=t.call(this,e,i,s)||this).actions.setFiltered(n.state.choices),n.Input.addEventListener("mousedown",function(){n.Dropdown.isVisible()?n.Dropdown.hide():n.Dropdown.show()}),n.Input.setPlaceholder(n.defaultPlaceholder),n.render(n.Input.value,n.state.filtered),n}s(e,t);var i=e.prototype;return i.clear=function(){this.actions.setSelected(null),this.Input.setPlaceholder(this.defaultPlaceholder),this.Input.setValue(""),this.ClearBtn.hide(),this.render(this.Input.value,this.state.filtered),this.onClear&&this.onClear()},i.onInput=function(t){var e=t.target.value;this.onValue&&this.onValue(e),e?this.ClearBtn.show():this.ClearBtn.hide(),e?this.source?this.fetchFromSource(e):this.onReceiveChoices(this.state.choices):(this.actions.setFiltered(this.state.choices),this.render(e,this.state.filtered),this.setShowDropdown(!0))},i.onFocus=function(){""!==this.Input.value&&this.Input.setValue(""),this.setShowDropdown(!0)},i.onBlur=function(){var t=this;this.state.selected?(setTimeout(function(){t.state.selected.value&&t.Input.value.trim()!==t.state.selected.value&&t.Input.setValue(t.state.selected.value)}),this.ClearBtn.show()):(""!==this.Input.value&&this.Input.setValue(""),this.ClearBtn.hide()),this.actions.setFiltered(this.state.choices),this.render(this.Input.value,this.state.filtered),this.setShowDropdown(!1)},i.onSelection=function(t){this.Input.setValue(t.value),this.Input.setPlaceholder(t.value),this.actions.setFiltered(this.state.choices),this.actions.setHighlighted(null),this.actions.setSelected(t),this.render(t.label,this.state.filtered),this.setShowDropdown(!1),this.ClearBtn.show(),this.Input.blur(),this.onSelect&&this.onSelect(t)},i.itemMouseDownEvt=function(t){this.onSelection(t)},e}(f);return function(){function t(t,e,i){this.service=e.selectMode?new m(t,e,i):new v(t,e,i)}var i=t.prototype;return i.clear=function(){this.service.clear()},i.destroy=function(){this.service.Input.removeAllEvents(),this.service.ClearBtn.removeAllEvents(),this.service.Dropdown.removeAllEvents(),this.service.UnorderedList.removeAllEvents(),delete this.service},e(t,[{key:"value",get:function(){return this.service.Input.value},set:function(t){this.service.Input.setValue(t)}},{key:"selected",get:function(){return this.service.state.selected}}]),t}()});
