var Etto=function(){"use strict";class t{constructor(t){this.el=t,this.listeners={}}addEventListener(t,e){t in this.listeners?console.warn("Cannot add multiple event listeners to Etto Element"):(this.listeners[t]=e,this.el.addEventListener(t,e))}removeEventListener(t){t in this.listeners&&(this.el.removeEventListener(t,this.listeners[t],!1),delete this.listeners[t])}removeAllEvents(){for(const t in this.listeners)this.removeEventListener(t)}applyClassList(t){this.el.classList.add(...t)}applyAttributes(t){for(let e in t)this.el.setAttribute(e,t[e])}appendChild(t){this.el.appendChild(t)}setDisplay(t){this.el.style.display=t}}class e extends t{constructor(t,e,s,i,h,l,n,o,r){super(t),this.applyClassList(["etto-input",...o||[]]),this.applyAttributes({type:"text",autocomplete:"off",value:"",style:`box-sizing: border-box; cursor: ${n?"default":"text"};`,tabIndex:n?"-1":"0",placeholder:r}),this.onValue=l,this.addEventListener("input",e),this.addEventListener("focus",s),this.addEventListener("blur",i),this.addEventListener("keydown",h)}get offsetHeight(){return this.el.offsetHeight}get value(){return this.el.value}setValue(t){this.el.value=t,this.onValue&&this.onValue(t)}setPlaceholder(t){this.el.placeholder=t}focus(){this.el.focus()}blur(){this.el.blur()}setCursorToEnd(){this.el.selectionStart=this.el.selectionEnd=this.el.value.length}}class s extends t{constructor(t,e){super(t),this.applyClassList(["etto-dropdown"]),this.applyAttributes({style:(e?"max-height: 300px; ":"")+(e?"overflow: hidden auto; ":"overflow: hidden; ")+"position: absolute; width: 100%; z-index: 99;"}),this.hide()}isVisible(){return"block"===this.el.style.display}hide(){this.setDisplay("none")}show(){this.setDisplay("block")}}class i extends t{constructor(t,e){super(t),this.dotSize=e||6,this.dots=[],this.currentDot=0,this.loOpacity="0.3",this.hiOpacity="0.7",this.applyClassList(["etto-spinner"]),this.applyAttributes({style:"position: absolute; display: none; align-items: center; right: 2rem;"}),this.createDots(),this.animateDots()}hide(){this.setDisplay("none")}show(){this.setDisplay("flex")}createDots(){for(let t=0;t<3;t++){const t=document.createElement("div");t.classList.add("etto-spinner-dot"),t.setAttribute("style","border-radius: 2em; margin: 0 0.1em; display: inline-block; transition: all 0.3s ease;"),t.style.height=this.dotSize+"px",t.style.width=this.dotSize+"px",this.dots.push(t),this.el.appendChild(t)}}animateDots(){for(let t=0;t<this.dots.length;t++)this.dots[t].style.opacity=this.loOpacity;this.currentDot==this.dots.length&&(this.currentDot=0),this.dots[this.currentDot].style.opacity=this.hiOpacity,this.currentDot+=1}}class h extends t{constructor(t,e){super(t),this.applyClassList(["etto-clear-btn"]),this.applyAttributes({style:"opacity: 0.7; position: absolute; display: none; right: 0.8rem; cursor: pointer; font-family: sans-serif; font-size: 20px; font-weight: 400; "}),this.addEventListener("click",e),this.el.innerHTML="&times;"}show(){this.el.style.display="flex"}hide(){this.el.style.display="none"}}function l(t,e,s,i){const h=t.toUpperCase();let l=e.filter(t=>{const e=t.label;let i=e.toUpperCase().indexOf(h);const l=!s||(void 0===e[i-1]||" "===e[i-1]);return i>-1&&l});return void 0!==i&&(l=l.slice(0,i)),l}function n(t){return Object.assign({},t,{label:t.label,value:void 0!==t.value&&null!==t.value?t.value:t.label})}class o extends t{constructor(t,e,s,i){super(t),this.itemMouseDownEvt=e,this.createItemFn=s||this.createListItem,this.emptyHtml=i||"<em>No results.</em>",this.applyClassList(["etto-ul"])}setInnerHtml(t){this.el.innerHTML=t}createListItem(t,e,s,i,h){let l="etto-li";return i&&(l+=" etto-highlighted"),h&&(l+=" etto-selected"),`<li class="${l}" style="list-style-type: none; cursor: default" data-label="${t.label}" data-value="${t.value}" data-index="${e}">`+function(t,e){const s=t.replace(/&/g,"").replace(/</g,"").replace(/>/g,""),i=e.length,h=t.toUpperCase().indexOf(e.toUpperCase());return h<0?s:`${s.slice(0,h)}<b>${s.slice(h,h+i)}</b>${s.slice(h+i)}`}(t.label,s)+"</li>"}populateList(t,e,s,i){this.setInnerHtml("");let h="";const l=e.length;if(l>0){for(let n=0;n<l;n++){const l=!!i&&e[n].value===i.value,o=n===s;h+=this.createItemFn(e[n],n,t,o,l)}this.setInnerHtml(h),this.removeEventListener("mousedown"),this.addEventListener("mousedown",t=>{t.target&&"LI"==t.target.nodeName&&this.itemMouseDownEvt(e[t.target.dataset.index])})}else h+='<li class="etto-li etto-empty">'+this.emptyHtml+"</li>",this.setInnerHtml(h)}}class r{constructor(t){this.state=t}setHighlighted(t){this.state.highlighted=t}setSelected(t){this.state.selected=t}setCache(t){this.state.cache=t}setChoices(t){this.state.choices=t}setFiltered(t){this.state.filtered=t}setIsFetching(t){this.state.isFetching=t}setSpinnerTimer(t){this.state.spinnerTimer=t}clearSpinnerTimer(){clearInterval(this.state.spinnerTimer)}setFetchTimer(t){this.state.fetchTimer=t}clearFetchTimer(){clearTimeout(this.state.fetchTimer)}}class a{constructor(t,a={},c){this.selectMode=a.selectMode||!1,this.source=a.source||void 0,this.minChars=a.minChars||3,this.maxResults=a.maxResults||7,this.requestDelay=a.requestDelay||350,this.matchFullWord=a.matchFullWord||!1,this.showEmptyMsg=void 0===a.showEmptyMsg||a.showEmptyMsg,this.initialCache=a.initialCache||{},this.defaultPlaceholder=a.placeholder||(a.selectMode?"Select...":""),this.emptyHtml=a.emptyHtml||void 0,this.createItemFn=a.createItemFn||void 0,this.filterFn=a.filterFn||l,this.onSelect=a.onSelect||void 0,this.onClear=a.onClear||void 0,this.onValue=a.onValue||void 0;const d=c?c.map(n):[];this.state={isFetching:!1,cache:this.initialCache,choices:d,filtered:[],selected:null,highlighted:null,spinnerTimer:null,fetchTimer:null},this.actions=new r(this.state),this.Input=new e(document.createElement("input"),this.onInput.bind(this),this.onFocus.bind(this),this.onBlur.bind(this),this.onKeydown.bind(this),this.onValue,this.selectMode,a.classList,this.defaultPlaceholder),this.Spinner=new i(document.createElement("div"),6),this.ClearBtn=new h(document.createElement("div"),this.clear.bind(this)),this.UnorderedList=new o(document.createElement("ul"),this.itemMouseDownEvt.bind(this),this.createItemFn,this.emptyHtml),this.Dropdown=new s(document.createElement("div"),this.selectMode),this.Dropdown.appendChild(this.UnorderedList.el),this.container=document.createElement("div"),this.container.classList.add("etto-container"),this.container.setAttribute("style","position: relative;");const u=document.createElement("div");u.classList.add("etto-input-container"),u.setAttribute("style","position: relative;"),u.appendChild(this.Input.el),u.appendChild(this.ClearBtn.el),u.appendChild(this.Spinner.el),this.container.appendChild(u),this.container.appendChild(this.Dropdown.el),this.root=t,this.root.appendChild(this.container)}render(t,e){this.UnorderedList.populateList(t,e,this.state.highlighted,this.state.selected)}setShowDropdown(t){t?this.Dropdown.show():this.Dropdown.hide(),!t&&this.state.highlighted&&this.actions.setHighlighted(null)}fetchFromSource(t){const e=t.toUpperCase().trim();this.state.cache[e]?this.onReceiveChoices(this.state.cache[e]):(this.state.fetchTimer&&this.actions.clearFetchTimer(),this.actions.setFetchTimer(setTimeout(()=>{this.actions.setIsFetching(!0),this.actions.setSpinnerTimer(setInterval(this.Spinner.animateDots.bind(this.Spinner),300)),this.Spinner.show(),this.source(t,t=>{const s=t?t.map(n):[];this.actions.setCache({...this.state.cache,[e]:s}),this.actions.setIsFetching(!1),this.Spinner.hide(),this.actions.clearSpinnerTimer(),this.onReceiveChoices(s)})},this.requestDelay)))}onReceiveChoices(t){const e=this.filterFn(this.Input.value,t,this.matchFullWord,this.maxResults);this.actions.setChoices(t),this.actions.setFiltered(e),this.render(this.Input.value,e),this.showEmptyMsg?this.setShowDropdown(!0):this.setShowDropdown(e.length>0)}onKeydown(t){let e=this.Dropdown.isVisible();if((38==t.keyCode||40==t.keyCode)&&e){t.preventDefault(),38==t.keyCode&&(null===this.state.highlighted?this.actions.setHighlighted(0):0!==this.state.highlighted&&this.actions.setHighlighted(this.state.highlighted-1)),40==t.keyCode&&(null===this.state.highlighted?this.actions.setHighlighted(0):this.state.highlighted!==this.state.filtered.length-1&&this.actions.setHighlighted(this.state.highlighted+1)),this.render(this.Input.value,this.state.filtered),this.setShowDropdown(this.state.filtered.length>0);const e=this.UnorderedList.el.getElementsByClassName("etto-highlighted")[0];if(null!=e)try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(t){}}if((9==t.keyCode||13==t.keyCode)&&e&&(t.preventDefault(),null!==this.state.highlighted)){const t=this.state.filtered[this.state.highlighted];this.onSelection(t)}}}class c extends a{constructor(t,e,s){super(t,e,s),this.render(this.Input.value,this.state.filtered)}clear(){this.actions.setSelected(null),this.actions.setFiltered([]),this.Input.setValue(""),this.ClearBtn.hide(),this.render(this.Input.value,this.state.filtered),this.onClear&&this.onClear()}onInput(t){const e=t.target.value;this.onValue&&this.onValue(e),e?this.ClearBtn.show():this.ClearBtn.hide(),e&&e.trim().length>=this.minChars?this.source?this.fetchFromSource(e):this.onReceiveChoices(this.state.choices):(this.actions.setFiltered([]),this.render(e,[]),this.setShowDropdown(!1))}onFocus(){this.setShowDropdown(this.state.filtered.length>0),this.Input.setCursorToEnd()}onBlur(){null!==this.state.highlighted&&(this.actions.setHighlighted(null),this.render(this.Input.value,this.state.filtered)),this.setShowDropdown(!1)}onSelection(t){const e=this.filterFn(t.label,this.state.choices,this.matchFullWord,this.maxResults);this.Input.setValue(t.value),this.actions.setFiltered(e),this.actions.setHighlighted(null),this.render(t.label,e),this.setShowDropdown(!1),this.onSelect&&this.onSelect(t)}itemMouseDownEvt(t){this.onSelection(t),this.Input.focus()}}class d extends a{constructor(t,e,s){super(t,e,s),this.actions.setFiltered(this.state.choices),this.Input.addEventListener("mousedown",()=>{this.Dropdown.isVisible()?this.Dropdown.hide():this.Dropdown.show()}),this.Input.setPlaceholder(this.defaultPlaceholder),this.render(this.Input.value,this.state.filtered)}clear(){this.actions.setSelected(null),this.Input.setPlaceholder(this.defaultPlaceholder),this.Input.setValue(""),this.ClearBtn.hide(),this.render(this.Input.value,this.state.filtered),this.onClear&&this.onClear()}onInput(t){const e=t.target.value;this.onValue&&this.onValue(e),e?this.ClearBtn.show():this.ClearBtn.hide(),e?this.source?this.fetchFromSource(e):this.onReceiveChoices(this.state.choices):(this.actions.setFiltered(this.state.choices),this.render(e,this.state.filtered),this.setShowDropdown(!0))}onFocus(){""!==this.Input.value&&this.Input.setValue(""),this.setShowDropdown(!0)}onBlur(){this.state.selected?(setTimeout(()=>{this.state.selected.value&&this.Input.value.trim()!==this.state.selected.value&&this.Input.setValue(this.state.selected.value)}),this.ClearBtn.show()):(""!==this.Input.value&&this.Input.setValue(""),this.ClearBtn.hide()),this.actions.setFiltered(this.state.choices),this.render(this.Input.value,this.state.filtered),this.setShowDropdown(!1)}onSelection(t){this.Input.setValue(t.value),this.Input.setPlaceholder(t.value),this.actions.setFiltered(this.state.choices),this.actions.setHighlighted(null),this.actions.setSelected(t),this.render(t.label,this.state.filtered),this.setShowDropdown(!1),this.ClearBtn.show(),this.Input.blur(),this.onSelect&&this.onSelect(t)}itemMouseDownEvt(t){this.onSelection(t)}}return class{constructor(t,e,s){e.selectMode?this.service=new d(t,e,s):this.service=new c(t,e,s)}get value(){return this.service.Input.value}set value(t){this.service.Input.setValue(t)}get selected(){return this.service.state.selected}clear(){this.service.clear()}destroy(){this.service.Input.removeAllEvents(),this.service.ClearBtn.removeAllEvents(),this.service.Dropdown.removeAllEvents(),this.service.UnorderedList.removeAllEvents(),delete this.service}}}();
