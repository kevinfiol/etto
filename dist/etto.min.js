var Etto=function(){"use strict";function t(t){this.el=t}t.prototype.addEventListener=function(t,e){this.el.addEventListener(t,e)},t.prototype.applyClassList=function(t){for(var e=0;e<t.length;e++)this.el.classList.add(t[e])},t.prototype.applyAttributes=function(t){for(var e in t)this.el.setAttribute(e,t[e])},t.prototype.appendChild=function(t){this.el.appendChild(t)},t.prototype.setDisplay=function(t){this.el.style.display=t};var o=function(o){function t(t,e,s,i,n){o.call(this,t),this.applyClassList(["etto-input"]),this.applyAttributes({autocomplete:"off",value:"",style:"box-sizing: border-box;"}),this.addEventListener("input",e),this.addEventListener("focus",s),this.addEventListener("blur",i),this.addEventListener("keydown",n)}o&&(t.__proto__=o),(t.prototype=Object.create(o&&o.prototype)).constructor=t;var e={offsetHeight:{configurable:!0}};return e.offsetHeight.get=function(){return this.el.offsetHeight},t.prototype.setValue=function(t){this.el.value=t},t.prototype.focus=function(){this.el.focus()},Object.defineProperties(t.prototype,e),t}(t),r=function(e){function t(t){e.call(this,t),this.applyClassList(["etto-dropdown"]),this.applyAttributes({style:"position: absolute; width: 100%; background-color: white; overflow: hidden; z-index: 99;"}),this.setDisplay("none")}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(t),a=function(i){function t(t,e,s){i.call(this,t),this.dotSize=6,this.dots=[],this.currentDot=0,this.loOpacity="0.3",this.hiOpacity="0.7",this.applyClassList(["etto-spinner"]),this.applyAttributes({style:"position: absolute; display: none; align-items: center; right: 1em;"}),this.el.style.top=s,this.createDots(),this.animateDots()}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.createDots=function(){for(var t=0;t<3;t++){var e=document.createElement("div");e.classList.add("etto-spinner-dot"),e.setAttribute("style","border-radius: 2em; margin: 0 0.1em; display: inline-block; transition: all 0.3s ease;"),e.style.height=this.dotSize+"px",e.style.width=this.dotSize+"px",this.dots.push(e),this.el.appendChild(e)}this.animateDots()},t.prototype.animateDots=function(){for(var t=0;t<this.dots.length;t++)this.dots[t].style.opacity=this.loOpacity;this.currentDot==this.dots.length&&(this.currentDot=0),this.dots[this.currentDot].style.opacity=this.hiOpacity,this.currentDot+=1},t}(t);function n(t,e,n,s){var o=t.toUpperCase(),i=e.filter(function(t){var e=t.label,s=e.toUpperCase().indexOf(o),i=!n||(void 0===e[s-1]||" "===e[s-1]);return-1<s&&i});return void 0!==s&&(i=i.slice(0,s)),i}function c(t){return Object.assign({},t,{label:t.label,value:t.value||t.label})}function h(t){this.state=t}var l=function(i){function t(t,e,s){i.call(this,t),this.createItemMousedownEvt=e,this.createItemFn=s||this.createListItem,this.applyClassList(["etto-ul"])}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.clearList=function(){this.el.innerHTML=""},t.prototype.createListItem=function(t,e,s){var i,n,o,r,a,c=document.createElement("li");return c.classList.add("etto-li"),s?c.classList.add("etto-selected"):c.classList.remove("etto-selected"),c.setAttribute("style","list-style-type: none; cursor: default;"),c.innerHTML=(i=t.label,n=e,o=i.replace(/&/g,"").replace(/</g,"").replace(/>/g,""),r=n.length,a=i.toUpperCase().indexOf(n.toUpperCase()),o.slice(0,a)+"<b>"+o.slice(a,a+r)+"</b>"+o.slice(a+r)),c.dataset.label=t.label,c.dataset.value=t.value,c},t.prototype.populateList=function(t,e,s){this.clearList();for(var i=0;i<e.length;i++){var n=e[i],o=i===s,r=this.createItemFn(n,t,o),a=this.createItemMousedownEvt(n.label,n.value);r.addEventListener("mousedown",a),this.appendChild(r)}},t}(t);h.prototype.setSelected=function(t){this.state.selected=t},h.prototype.setCache=function(t){this.state.cache=t},h.prototype.setInputVal=function(t){this.state.inputVal=t},h.prototype.setChoices=function(t){this.state.choices=t},h.prototype.setFiltered=function(t){this.state.filtered=t},h.prototype.setIsFetching=function(t){this.state.isFetching=t},h.prototype.setSpinnerTimer=function(t){this.state.spinnerTimer=t},h.prototype.clearSpinnerTimer=function(){clearInterval(this.state.spinnerTimer)},h.prototype.setFetchTimer=function(t){this.state.fetchTimer=t},h.prototype.clearFetchTimer=function(){clearTimeout(this.state.fetchTimer)};function e(t,e,s){this.state={isFetching:!1,cache:e.initialCache||{},choices:s?s.map(c):[],filtered:[],inputVal:"",selected:null,spinnerTimer:null,fetchTimer:null},this.actions=new h(this.state),this.selectMode=e.selectMode||!1,this.source=e.source||void 0,this.minChars=e.minChars||3,this.maxResults=e.maxResults||7,this.requestDelay=e.requestDelay||350,this.matchFullWord=e.matchFullWord||!1,this.createItemFn=e.createItemFn||void 0,this.Input=new o(document.createElement("input"),this.onInput.bind(this),this.onFocus.bind(this),this.onBlur.bind(this),this.onKeydown.bind(this)),this.UnorderedList=new l(document.createElement("ul"),this.createItemMousedownEvt.bind(this),this.createItemFn),this.Dropdown=new r(document.createElement("div")),this.Dropdown.appendChild(this.UnorderedList.el),this.container=document.createElement("div"),this.container.classList.add("etto-container"),this.container.setAttribute("style","position: relative;");var i=document.createElement("div");i.setAttribute("style","position: relative;"),i.appendChild(this.Input.el),this.container.appendChild(i),this.container.appendChild(this.Dropdown.el),this.root=t,this.root.appendChild(this.container);var n=this.Input.offsetHeight/2-3+"px";this.Spinner=new a(document.createElement("div"),6,n),this.container.appendChild(this.Spinner.el),this.render(this.state.inputVal,this.state.filtered)}return e.prototype.render=function(t,e){this.UnorderedList.populateList(t,e,this.state.selected)},e.prototype.setShowDropdown=function(t){this.Dropdown.setDisplay(t?"block":"none"),!t&&this.state.selected&&this.actions.setSelected(null)},e.prototype.fetchFromSource=function(t){var i=this,n=t.toUpperCase().trim();this.state.cache[n]?this.onReceiveChoices(this.state.cache[n]):(this.state.fetchTimer&&this.actions.clearFetchTimer(),this.actions.setFetchTimer(setTimeout(function(){i.actions.setIsFetching(!0),i.actions.setSpinnerTimer(setInterval(i.Spinner.animateDots.bind(i.Spinner),300)),i.Spinner.setDisplay("flex"),i.source(t,function(t){var e,s=t?t.map(c):[];i.actions.setCache(Object.assign({},i.state.cache,((e={})[n]=s,e))),i.actions.setIsFetching(!1),i.Spinner.setDisplay("none"),i.actions.clearSpinnerTimer(),i.onReceiveChoices(s)})},this.requestDelay)))},e.prototype.onReceiveChoices=function(t){var e=n(this.state.inputVal,t,this.matchFullWord,this.maxResults);this.actions.setChoices(t),this.actions.setFiltered(e),this.render(this.state.inputVal,e),this.setShowDropdown(0<e.length)},e.prototype.createItemMousedownEvt=function(e,s){var i=this;return function(){var t=n(s,i.state.choices,i.matchFullWord,i.maxResults);i.actions.setInputVal(s),i.actions.setFiltered(t),i.render(e,t),i.setShowDropdown(0<t.length),i.Input.setValue(s),i.Input.focus()}},e.prototype.onInput=function(t){var e=t.target.value;this.actions.setInputVal(e),e&&e.trim().length>=this.minChars?this.source?this.fetchFromSource(e):this.onReceiveChoices(this.state.choices):(this.render(e,[]),this.setShowDropdown(!1))},e.prototype.onFocus=function(){this.setShowDropdown(0<this.state.filtered.length)},e.prototype.onBlur=function(){this.state.selected&&(this.actions.setSelected(null),this.render(this.state.inputVal,this.state.filtered)),this.setShowDropdown(!1)},e.prototype.onKeydown=function(t){var e="block"===this.Dropdown.el.style.display;if(38!=t.keyCode&&40!=t.keyCode||!e||(t.preventDefault(),38==t.keyCode&&(null===this.state.selected?this.actions.setSelected(0):0!==this.state.selected&&this.actions.setSelected(this.state.selected-1)),40==t.keyCode&&(null===this.state.selected?this.actions.setSelected(0):this.state.selected!==this.state.filtered.length-1&&this.actions.setSelected(this.state.selected+1)),this.render(this.state.inputVal,this.state.filtered),this.setShowDropdown(0<this.state.filtered.length)),(9==t.keyCode||13==t.keyCode)&&e){t.preventDefault();var s=void 0;if(null!==this.state.selected){s=this.state.filtered[this.state.selected].label,this.actions.setInputVal(s),this.actions.setSelected(null),this.Input.setValue(s);var i=n(s,this.state.choices,this.matchFullWord,this.maxResults);this.render(s,i),this.setShowDropdown(!1)}}},e}();
