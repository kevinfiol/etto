var Etto=function(){"use strict";function t(t){this.el=t}t.prototype.addEventListener=function(t,e){this.el.addEventListener(t,e)},t.prototype.applyClassList=function(t){for(var e=0;e<t.length;e++)this.el.classList.add(t[e])},t.prototype.applyAttributes=function(t){for(var e in t)this.el.setAttribute(e,t[e])},t.prototype.appendChild=function(t){this.el.appendChild(t)},t.prototype.setDisplay=function(t){this.el.style.display=t};var e=t,r=function(h){function t(t,e,i,s,o,n){h.call(this,t),this.applyClassList(["etto-input"]),this.applyAttributes({autocomplete:"off",value:"",style:"box-sizing: border-box; cursor: "+(n?"default":"text")+";",tabIndex:n?"-1":"0"}),this.addEventListener("input",e),this.addEventListener("focus",i),this.addEventListener("blur",s),this.addEventListener("keydown",o)}h&&(t.__proto__=h),(t.prototype=Object.create(h&&h.prototype)).constructor=t;var e={offsetHeight:{configurable:!0},value:{configurable:!0}};return e.offsetHeight.get=function(){return this.el.offsetHeight},e.value.get=function(){return this.el.value},t.prototype.setValue=function(t){this.el.value=t},t.prototype.setPlaceholder=function(t){this.el.placeholder=t},t.prototype.focus=function(){this.el.focus()},t.prototype.blur=function(){this.el.blur()},Object.defineProperties(t.prototype,e),t}(e),l=function(i){function t(t,e){i.call(this,t),this.applyClassList(["etto-dropdown"]),this.applyAttributes({style:(e?"max-height: 300px; ":"")+(e?"overflow: hidden auto; ":"overflow: hidden; ")+"position: absolute; width: 100%; background-color: white; z-index: 99;"}),this.hide()}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.isVisible=function(){return"block"===this.el.style.display},t.prototype.hide=function(){this.setDisplay("none")},t.prototype.show=function(){this.setDisplay("block")},t}(e),a=function(s){function t(t,e,i){s.call(this,t),this.dotSize=6,this.dots=[],this.currentDot=0,this.loOpacity="0.3",this.hiOpacity="0.7",this.applyClassList(["etto-spinner"]),this.applyAttributes({style:"position: absolute; display: none; align-items: center; right: 2em;"}),this.el.style.top=i+"px",this.createDots(),this.animateDots()}return s&&(t.__proto__=s),((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.hide=function(){this.setDisplay("none")},t.prototype.show=function(){this.setDisplay("flex")},t.prototype.createDots=function(){for(var t=0;t<3;t++){var e=document.createElement("div");e.classList.add("etto-spinner-dot"),e.setAttribute("style","border-radius: 2em; margin: 0 0.1em; display: inline-block; transition: all 0.3s ease;"),e.style.height=this.dotSize+"px",e.style.width=this.dotSize+"px",this.dots.push(e),this.el.appendChild(e)}},t.prototype.animateDots=function(){for(var t=0;t<this.dots.length;t++)this.dots[t].style.opacity=this.loOpacity;this.currentDot==this.dots.length&&(this.currentDot=0),this.dots[this.currentDot].style.opacity=this.hiOpacity,this.currentDot+=1},t}(e),c=function(o){function t(t,e,i,s){o.call(this,t),this.applyClassList(["etto-clear-btn"]),this.applyAttributes({style:"opacity: 0.7; position: absolute; display: none; align-items: center; right: 0.6em; cursor: pointer; font-family: sans-serif; font-size: 20px; font-weight: 400; height: "+e+"px; top: "+i+"px;"}),this.addEventListener("click",s),this.el.innerHTML="&times;"}return o&&(t.__proto__=o),((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.show=function(){this.el.style.display="flex"},t.prototype.hide=function(){this.el.style.display="none"},t}(e);function n(t){return t.replace(/&/g,"").replace(/</g,"").replace(/>/g,"")}function i(t){this.state=t}var s=function(t,e,o,i){var n=t.toUpperCase(),s=e.filter(function(t){var e=t.label,i=e.toUpperCase().indexOf(n),s=!o||(void 0===e[i-1]||" "===e[i-1]);return-1<i&&s});return void 0!==i&&(s=s.slice(0,i)),s},o=function(t){return Object.assign({},t,{label:t.label,value:t.value||t.label})},h=function(t,e){var i=n(t),s=e.length,o=t.toUpperCase().indexOf(e.toUpperCase());return o<0?i:i.slice(0,o)+"<b>"+i.slice(o,o+s)+"</b>"+i.slice(o+s)},p=function(o){function t(t,e,i,s){o.call(this,t),this.createItemMousedownEvt=e,this.createItemFn=i||this.createListItem,this.emptyHtml=s||"<em>No results.</em>",this.applyClassList(["etto-ul"])}return o&&(t.__proto__=o),((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.setInnerHtml=function(t){this.el.innerHTML=t},t.prototype.createListItem=function(t,e,i,s){var o="etto-li";return i&&(o+=" etto-highlighted"),s&&(o+=" etto-selected"),'<li class="'+o+'" style="list-style-type: none; cursor: default" data-label="'+t.label+'" data-value="'+t.value+'">'+h(t.label,e)+"</li>"},t.prototype.populateList=function(t,e,i,s){this.setInnerHtml("");var o="",n=e.length;if(0<n){for(var h=0;h<n;h++){var r=!!s&&e[h].value===s.value,l=h===i;o+=this.createItemFn(e[h],t,l,r)}this.setInnerHtml(o);for(var a=0;a<n;a++){this.el.children[a].addEventListener("mousedown",this.createItemMousedownEvt(e[a]))}}else o+='<li class="etto-li etto-empty">'+this.emptyHtml+"</li>",this.setInnerHtml(o)},t}(e);i.prototype.setHighlighted=function(t){this.state.highlighted=t},i.prototype.setSelected=function(t){this.state.selected=t},i.prototype.setCache=function(t){this.state.cache=t},i.prototype.setChoices=function(t){this.state.choices=t},i.prototype.setFiltered=function(t){this.state.filtered=t},i.prototype.setIsFetching=function(t){this.state.isFetching=t},i.prototype.setSpinnerTimer=function(t){this.state.spinnerTimer=t},i.prototype.clearSpinnerTimer=function(){clearInterval(this.state.spinnerTimer)},i.prototype.setFetchTimer=function(t){this.state.fetchTimer=t},i.prototype.clearFetchTimer=function(){clearTimeout(this.state.fetchTimer)};function u(t,e,i){this.selectMode=e.selectMode||!1,this.source=e.source||void 0,this.minChars=e.minChars||3,this.maxResults=e.maxResults||7,this.requestDelay=e.requestDelay||350,this.matchFullWord=e.matchFullWord||!1,this.showEmptyMsg=void 0===e.showEmptyMsg||e.showEmptyMsg,this.emptyHtml=e.emptyHtml||void 0,this.createItemFn=e.createItemFn||void 0,this.filterFn=e.filterFn||f,this.onSelect=e.onSelect||void 0;var s=i?i.map(y):[];this.state={isFetching:!1,cache:e.initialCache||{},choices:s,filtered:[],selected:null,highlighted:null,spinnerTimer:null,fetchTimer:null},this.actions=new d(this.state),this.Input=new r(document.createElement("input"),this.onInput.bind(this),this.onFocus.bind(this),this.onBlur.bind(this),this.onKeydown.bind(this),this.selectMode),this.UnorderedList=new p(document.createElement("ul"),this.createItemMousedownEvt.bind(this),this.createItemFn,this.emptyHtml),this.Dropdown=new l(document.createElement("div"),this.selectMode),this.Dropdown.appendChild(this.UnorderedList.el),this.container=document.createElement("div"),this.container.classList.add("etto-container"),this.container.setAttribute("style","position: relative;");var o=document.createElement("div");o.setAttribute("style","position: relative;"),o.appendChild(this.Input.el),this.container.appendChild(o),this.container.appendChild(this.Dropdown.el),this.root=t,this.root.appendChild(this.container);var n=this.Input.offsetHeight/2-3;this.Spinner=new a(document.createElement("div"),6,n),this.container.appendChild(this.Spinner.el);var h=this.Input.offsetHeight/2-11;this.ClearBtn=new c(document.createElement("div"),22,h,this.clear.bind(this)),this.container.appendChild(this.ClearBtn.el)}var d=i,f=s,y=o;u.prototype.render=function(t,e){this.UnorderedList.populateList(t,e,this.state.highlighted,this.state.selected)},u.prototype.setShowDropdown=function(t){t?this.Dropdown.show():this.Dropdown.hide(),!t&&this.state.highlighted&&this.actions.setHighlighted(null)},u.prototype.fetchFromSource=function(t){var s=this,o=t.toUpperCase().trim();this.state.cache[o]?this.onReceiveChoices(this.state.cache[o]):(this.state.fetchTimer&&this.actions.clearFetchTimer(),this.actions.setFetchTimer(setTimeout(function(){s.actions.setIsFetching(!0),s.actions.setSpinnerTimer(setInterval(s.Spinner.animateDots.bind(s.Spinner),300)),s.Spinner.show(),s.source(t,function(t){var e,i=t?t.map(y):[];s.actions.setCache(Object.assign({},s.state.cache,((e={})[o]=i,e))),s.actions.setIsFetching(!1),s.Spinner.hide(),s.actions.clearSpinnerTimer(),s.onReceiveChoices(i)})},this.requestDelay)))},u.prototype.onReceiveChoices=function(t){var e=this.filterFn(this.Input.value,t,this.matchFullWord,this.maxResults);this.actions.setChoices(t),this.actions.setFiltered(e),this.render(this.Input.value,e),this.showEmptyMsg?this.setShowDropdown(!0):this.setShowDropdown(0<e.length)},u.prototype.onKeydown=function(t){var e=this.Dropdown.isVisible();if((38==t.keyCode||40==t.keyCode)&&e){t.preventDefault(),38==t.keyCode&&(null===this.state.highlighted?this.actions.setHighlighted(0):0!==this.state.highlighted&&this.actions.setHighlighted(this.state.highlighted-1)),40==t.keyCode&&(null===this.state.highlighted?this.actions.setHighlighted(0):this.state.highlighted!==this.state.filtered.length-1&&this.actions.setHighlighted(this.state.highlighted+1)),this.render(this.Input.value,this.state.filtered),this.setShowDropdown(0<this.state.filtered.length);var i=this.UnorderedList.el.getElementsByClassName("etto-highlighted")[0];if(null!=i)try{i.scrollIntoView({block:"nearest",inline:"nearest"})}catch(t){}}if((9==t.keyCode||13==t.keyCode)&&e&&(t.preventDefault(),null!==this.state.highlighted)){var s=this.state.filtered[this.state.highlighted];this.onSelection(s)}};var m=u,v=function(s){function t(t,e,i){s.call(this,t,e,i),this.render(this.Input.value,this.state.filtered)}return s&&(t.__proto__=s),((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.clear=function(){this.actions.setSelected(null),this.actions.setFiltered([]),this.Input.setValue(""),this.ClearBtn.hide(),this.render(this.Input.value,this.state.filtered)},t.prototype.onInput=function(t){var e=t.target.value;e?this.ClearBtn.show():this.ClearBtn.hide(),e&&e.trim().length>=this.minChars?this.source?this.fetchFromSource(e):this.onReceiveChoices(this.state.choices):(this.actions.setFiltered([]),this.render(e,[]),this.setShowDropdown(!1))},t.prototype.onFocus=function(){this.setShowDropdown(0<this.state.filtered.length)},t.prototype.onBlur=function(){null!==this.state.highlighted&&(this.actions.setHighlighted(null),this.render(this.Input.value,this.state.filtered)),this.setShowDropdown(!1)},t.prototype.onSelection=function(t){var e=this.filterFn(t.label,this.state.choices,this.matchFullWord,this.maxResults);this.Input.setValue(t.value),this.actions.setFiltered(e),this.actions.setHighlighted(null),this.render(t.label,e),this.setShowDropdown(!1),this.onSelect&&this.onSelect(t)},t.prototype.createItemMousedownEvt=function(t){var e=this;return function(){e.onSelection(t),e.Input.focus()}},t}(m),g=function(s){function t(t,e,i){s.call(this,t,e,i),this.actions.setFiltered(this.state.choices),this.render(this.Input.value,this.state.filtered)}return s&&(t.__proto__=s),((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.clear=function(){this.actions.setSelected(null),this.Input.setPlaceholder(""),this.Input.setValue(""),this.ClearBtn.hide(),this.render(this.Input.value,this.state.filtered)},t.prototype.onInput=function(t){var e=t.target.value;e?this.ClearBtn.show():this.ClearBtn.hide(),e?this.source?this.fetchFromSource(e):this.onReceiveChoices(this.state.choices):(this.actions.setFiltered(this.state.choices),this.render(e,this.state.filtered),this.setShowDropdown(!0))},t.prototype.onFocus=function(){this.Input.setValue(""),this.setShowDropdown(!0)},t.prototype.onBlur=function(){this.state.selected?(this.Input.setValue(this.state.selected.value),this.ClearBtn.show()):(this.Input.setValue(""),this.ClearBtn.hide()),this.actions.setFiltered(this.state.choices),this.render(this.Input.value,this.state.filtered),this.setShowDropdown(!1)},t.prototype.onSelection=function(t){var e=this;setTimeout(function(){e.Input.setValue(t.value),e.Input.setPlaceholder(t.value)}),this.actions.setFiltered(this.state.choices),this.actions.setHighlighted(null),this.actions.setSelected(t),this.render(t.label,this.state.filtered),this.setShowDropdown(!1),this.ClearBtn.show(),this.Input.blur(),this.onSelect&&this.onSelect(t)},t.prototype.createItemMousedownEvt=function(t){var e=this;return function(){e.onSelection(t)}},t}(m);return function(t,e,i){e.selectMode?this.service=new g(t,e,i):this.service=new v(t,e,i)}}();
